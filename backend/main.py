from db import get_database
import os
from dotenv import load_dotenv

load_dotenv()

db = get_database()
collection = db[os.getenv('USER_COLLECTION')]

item_details = collection.find({"user_name": "jannet"})

reports = item_details

print(reports[0])


# {'messages': 
# [HumanMessage(content='what is 4 + 5?', additional_kwargs={}, response_metadata={}, id='39a8ea62-ca77-4f2f-8ec6-47e038d95cb4'), 
# AIMessage(content='', additional_kwargs={'function_call': {'name': 'transfer_to_bob', 'arguments': '{}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'safety_ratings': []}, name='Ferta', id='run-5e414bed-3270-41bf-bf18-972c738dcb7f-0', tool_calls=[{'name': 'transfer_to_bob', 'args': {}, 'id': '4879dc15-6e62-4977-81b5-5356621beb44', 'type': 'tool_call'}], usage_metadata={'input_tokens': 73, 'output_tokens': 5, 'total_tokens': 78, 'input_token_details': {'cache_read': 0}}), 
# ToolMessage(content='Successfully transferred to Bob', name='transfer_to_bob', id='7ca34f22-0433-4af6-ba9a-03adf136302b', tool_call_id='4879dc15-6e62-4977-81b5-5356621beb44'), AIMessage(content='Ahoy matey! 4 + 5 be equal to 9, savvy?', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'safety_ratings': []}, name='Bob', id='run-15d90701-1e4f-4671-b523-85a456c7d9e6-0', usage_metadata={'input_tokens': 57, 'output_tokens': 19, 'total_tokens': 76, 'input_token_details': {'cache_read': 0}}), 
# HumanMessage(content='what is the health summary of Jannet?', additional_kwargs={}, response_metadata={}, id='09912099-3ff3-42e5-89d8-ae6c2336b8b5'), AIMessage(content='', additional_kwargs={'function_call': {'name': 'transfer_to_ferta', 'arguments': '{}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'safety_rating 'transfer_to_ferta', 'arguments': '{}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'safety_ratings': []}, name='Bob', id='run-a2aeb1cc-8f01-4b07-85ea-3cd5ea4c9507-0', tool_calls=[{'name': 'transfer_to_ferta', 'args': {}, 'id': 'b2545286-5a11-4308-9036-c884e6878968', 'type': 'tool_call'}], usage_metadata={'input_tokens': 84, 'output_tokens': 6, 'total_tokens': 90, 'input_token_details': {'cache_read': 0}}), 
# ToolMessage(content='Successfully transferred to Ferta', name='transfer_to_ferta', id='aa0b3fba-263e-49ae-811a-940daa424655', tool_call_id='b2545286-5a11-4308-9036-c884e6878968'), 
# AIMessage(content='', additional_kwargs={'function_call': {'name': 'fetch_report', 'arguments': '{"user_name": "Jannet"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'safety_ratings': []}, name='Ferta', id='run-d314a665-fc85-4972-95fd-96eaaede17b6-0', tool_calls=[{'name': 'fetch_report', 'args': {'user_name': 'Jannet'}, 'id': '36164199-c40f-48eb-a3c7-d21ad46c3b51', 'type': 'tool_call'}], usage_metadata={'input_tokens': 133, 'output_tokens': 8, 'total_tokens': 141, 'input_token_details': {'cache_read': 0}}), 
# ToolMessage(content='[{"report_type": "CT Scan", "report_details": "No signs of abnormality in the brain structure."}, {"report_type": "ENT Scan", "report_details": "Mild sinus congestion detected, no signs of infection."}, {"report_ 'transfer_to_ferta', 'arguments': '{}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'safety_ratings': []}, name='Bob', id='run-a2aeb1cc-8f01-4b07-85ea-3cd5ea4c9507-0', tool_calls=[{'name': 'transfer_to_ferta', 'args': {}, 'id': 'b2545286-5a11-4308-9036-c884e6878968', 'type': 'tool_call'}], usage_metadata={'input_tokens': 84, 'output_tokens': 6, 'total_tokens': 90, 'input_token_details': {'cache_read': 0}}), 
# ToolMessage(content='Successfully transferred to Ferta', name='transfer_to_ferta', id='aa0b3fba-263e-49ae-811a-940daa424655', tool_call_id='b2545286-5a11-4308-9036-c884e6878968'), 
# AIMessage(content='', additional_kwargs={'function_call': {'name': 'fetch_report', 'arguments': '{"user_name": "Jannet"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'safety_ratings': []}, name='Ferta', id='run-d314a665-fc85-4972-95fd-96eaaede17b6-0', tool_calls=[{'name': 'fetch_report', 'args': {'user_name': 'Jannet'}, 'id': '36164199-c40f-48eb-a3c7-d21ad46c3b51', 'type': 'tool_call'}], usage_metadata={'input_tokens 'transfer_to_ferta', 'arguments': '{}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'safety_ratings': []}, name='Bob', id='run-a2aeb1cc-8f01-4b07-85ea-3cd5ea4c9507-0', tool_calls=[{'name': 'transfer_to_ferta', 'args': {}, 'id': 'b2545286-5a11-4308-9036-c884e687s': []}, name='Bob', id='run-a2aeb1cc-8f01-4b07-85ea-3cd5ea4c9507-0', tool_calls=[{'name': 'transfer_to_ferta', 'args': {}, 'id': 'b2545286-5a11-4308-9036-c884e6878968', 'type': 'tool_call'}], usage_metadata={'input_tokens': 84, 'output_tokens': 6, 'total_tokens': 90, 'input_token_details': {'cache_read': 0}}), 
# ToolMessage(content='Successfully transferred to Ferta', name='transfer_to_ferta', id='aa0b3fba-263e-49ae-811a-940daa424655', tool_call_id='b2545286-5a11-4308-9036-c884e6878968'), 
# AIMessage(content='', additional_kwargs={'function_call': {'name': 'fetch_report', 'arguments': '{"user_name": "Jannet"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'safety_ratings': []}, name='Ferta', id='run-d314a665-fc85-4972-95fd-96eaaede17b6-0', tool_calls=[{'name': 'fetch_report', 'args': {'user_name': 'Jannet'}, 'id': '36164199-c40f-48eb-a3c7-d21ad46c3b51', 'type': 'tool_call'}], usage_metadata={'input_tokens8968', 'type': 'tool_call'}], usage_metadata={'input_tokens': 84, 'output_tokens': 6, 'total_tokens': 90, 'input_token_details': {'cache_read': 0}}), 
# ToolMessage(content='Successfully transferred to Ferta', name='transfer_to_ferta', id='aa0b3fba-263e-49ae-811a-940daa424655', tool_call_id='b2545286-5a11-4308-9036-c884e6878968'), 
# AIMessage(content='', additional_kwargs={'function_call': {'name': 'fetch_report', 'arguments': '{"user_name": "Jannet"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'safety_ratings': []}, name='Ferta', id='run-d314a665-fc85-4972-95fd-96eaaede17b6-0', tool_calls=[{'name': 'fetch_report', 'args': {'user_name': 'Jannet'}, 'id': '36164199-c40f-48eb-a3c7-d21ad46c3b51', 'type': 'tool_call'}], usage_metadata={'input_tokensontent='Successfully transferred to Ferta', name='transfer_to_ferta', id='aa0b3fba-263e-49ae-811a-940daa424655', tool_call_id='b2545286-5a11-4308-9036-c884e6878968'), 
# AIMessage(content='', additional_kwargs={'function_call': {'name': 'fetch_report', 'arguments': '{"user_name": "Jannet"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'safety_ratings': []}, name='Ferta', id='run-d314a665-fc85-4972-95fd-96eaaede17b6-0', tool_calls=[{'name': 'fetch_report', 'args': {'user_name': 'Jannet'}, 'id': '36164199-c40f-48eb-a3c7-d21ad46c3b51', 'type': 'tool_call'}], usage_metadata={'input_tokensk': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'safety_ratings': []}, name='Ferta', id='run-d314a665-fc85-4972-95fd-96eaaede17b6-0', tool_calls=[{'name': 'fetch_report', 'args': {'user_name': 'Jannet'}, 'id': '36164199-c40f-48eb-a3c7-d21ad46c3b51', 'type': 'tool_call'}], usage_metadata={'input_tokenscalls=[{'name': 'fetch_report', 'args': {'user_name': 'Jannet'}, 'id': '36164199-c40f-48eb-a3c7-d21ad46c3b51', 'type': 'tool_call'}], usage_metadata={'input_tokens': 133, 'output_tokens': 8, 'total_tokens': 141, 'input_token_details': {'cache_read': 0}}), 
# ToolMessage(content='[{"report_type": "CT Scan", "report_details": "No signs of abnormality in the brain structure."}, {"report_type": "ENT Scan", "report_details": "Mild sinus congestion detected, no signs of infection."}, {"report_type": "Blood Report", "report_details": "Slight iron deficiency; recommended dietary modifications."}, {"report_type": "Thyroid Function Test", "report_details": "TSH levels slightly elevated; further evaluation suggested."}]', name='fetch_report', id='c6860847-12ce-45f8-bfa7-ba592fc5f4ec', tool_call_id='36164199-c40f-48eb-a3c7-d21ad46c3b51'), 
# AIMessage(content="OK. Here is a summary of Jannet's health reports:\n\nCT Scan: No signs of abnormality in the brain structure.\nENT Scan: Mild sinus congestion detected, no signs of infection.\nBlood Report: Slight iron deficiency; recommended dietary modifications.\nThyroid Function Test: TSH levels slightly elevated; further evaluation suggested.", additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'safety_ratings': []}, name='Ferta', id='run-6ba59722-9d23-4638-ae04-4cdef600df1c-0', usage_metadata={'input_tokens': 216, 'output_tokens': 69, 'total_tokens': 285, 'input_token_details': {'cache_read': 0}})], 'active_agent': 'Ferta'}